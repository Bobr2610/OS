# Страничная организация памяти

**Страничная организация памяти (Paging)** — это схема управления памятью, при которой виртуальное адресное пространство процесса и физическая память делятся на блоки фиксированного размера (страницы и фреймы). Это позволяет избежать внешней фрагментации и эффективно реализовать механизм виртуальной памяти.

---

## Вопрос 36: Виртуальная память. Общие положения. Таблица страниц. TLB. Поддержка большого объема памяти

### Виртуальная память
Механизм управления памятью, при котором процессу предоставляется изолированное и непрерывное адресное пространство (виртуальное), которое отображается ОС на физическую память (RAM). Позволяет использовать больше памяти, чем есть физически (за счет свопинга на диск).

### Таблица страниц (Page Table)
Структура данных в оперативной памяти (хранится отдельно для каждого процесса), которая содержит отображение виртуальных адресов на физические.
*   Виртуальная память делится на блоки фиксированного размера — **страницы (pages)** (обычно 4 КБ).
*   Физическая память делится на блоки того же размера — **фреймы (frames)**.
*   Каждая запись таблицы страниц (PTE - Page Table Entry) хранит:
    *   Номер физического фрейма.
    *   Биты присутствия (P), записи (W), доступа (A), модификации (D) и прав доступа (User/Supervisor).

### TLB (Translation Lookaside Buffer)
Аппаратный кэш в процессоре (MMU), хранящий последние использованные трансляции «виртуальный адрес -> физический адрес».
*   Ускоряет доступ к памяти: при обращении к адресу сначала проверяется TLB (быстро).
*   Если записи нет в TLB (TLB Miss), происходит "прогулка" по таблице страниц (медленно) и загрузка записи в TLB.

### Поддержка большого объема памяти (Многоуровневые таблицы)
Для больших адресных пространств (64-бит) хранить одну плоскую таблицу невозможно. Используются иерархические таблицы:
1.  **Двухуровневая** (x86): Каталог таблиц -> Таблица страниц -> Фрейм.
2.  **Четырехуровневая** (x64): PML4 -> PDPT -> PD -> PT -> Фрейм.
Это позволяет хранить в памяти только те части таблицы, которые реально используются процессом (разреженность).

---

## Вопрос 37: Виртуальная память. Оптимизации при работе со страничной памятью, сегментирование

### Оптимизации страничной памяти
1.  **Инвертированная таблица страниц**: Вместо таблицы на каждый процесс создается одна глобальная таблица, где запись соответствует физическому фрейму (а не виртуальной странице). Экономит память под таблицы, но затрудняет поиск (требует хэширования).
2.  **Huge Pages (Большие страницы)**: Использование страниц размером 2 МБ или 1 ГБ вместо 4 КБ. Уменьшает размер таблиц страниц и количество промахов TLB (одна запись TLB покрывает больший объем памяти).
3.  **Copy-on-Write (CoW)**: При создании процесса (fork) память не копируется физически. Родитель и потомок читают одни и те же страницы. Копирование происходит только при попытке записи.

### Сегментирование
Альтернативный или дополнительный механизм управления памятью.
*   Память делится на логические блоки разного размера — **сегменты** (код, данные, стек).
*   Адрес состоит из: `Селектор сегмента : Смещение`.
*   **Плюсы**: Логическое разделение, защита на уровне модулей, возможность совместного использования кода.
*   **Минусы**: Внешняя фрагментация (сложно найти место для сегмента нужного размера).
*   **В современных ОС**: Используется **плоская модель памяти** (сегменты CS, DS, SS указывают на все адресное пространство), а основную работу выполняет страничный механизм. Сегментация осталась рудиментарно (например, для TLS - Thread Local Storage через FS/GS регистры).
